个人客户接口API

| 文件状态： [ ] 草稿 [√] 正式发布 [ ] 正在修改 | 文件标识： |              |          |          |          |
|-----------------------------------------------|------------|--------------|----------|----------|----------|
|                                               | 文档版本： | 1.0.0        |          |          |          |
|                                               | 作 者：    |              |          |          |          |
|                                               | 完成日期： | 2015-07-07   |          |          |          |
| **修订历史**                                  |            |              |          |          |          |
| **编号**                                      | **日期**   | **修订描述** | **版本** | **作者** | **审核** |
| 1                                             | 2015-07-07 | 初稿         | 1.0      |          |          |

[1. 功能设计 4](#功能设计)

[1.1 开户业务 4](#开户业务)

[1.1.1 简易开户 4](#_Toc29476)

[1.2 信息更新 10](#信息查询)

[1.2.1 用户基础信息 10](#客户基础信息-1)

[1.2.2 安全信息 13](#安全信息)

[1.2.3 客户基础信息 23](#客户基础信息-1)

[1.3 信息查询 27](#信息查询)

[1.3.1 客户基础信息 27](#客户基础信息)

[1.3.2 用户基础信息 31](#用户基础信息)

[1.4 销户 34](#销户)

[1.4.1 用户销户 34](#用户销户)

[1.5 协议管理 35](#协议管理)

[1.5.1 用户级业务 35](#用户级业务)

[1.5.2 协议终止 45](#普通业务订购含密码校验和验证码)

[1.6 余额查询 49](#余额查询)

[1.6.1 余额查询 49](#余额查询-1)

[1.7 鉴权 50](#鉴权)

[1.7.1 登录密码鉴权 50](#登录密码鉴权)

[1.7.2 支付密码鉴权 52](#支付密码鉴权)

[1.7.3 发送短信验证码 54](#发送短信验证码)

[1.7.4 短信验证码验证 55](#短信验证码验证)

[1.8 客户归并 55](#客户归并)

[1.8.1 用户鉴权客户归并 55](#用户鉴权客户归并)

[2. 附录 57](#附录)

[2.1 锁定规则 57](#锁定规则)

功能设计
========

开户业务
--------


### 用户激活

| **接口名称** | **用户激活**                                             | **接口编号** | **CIF-1003**                               |              |
|--------------|----------------------------------------------------------|--------------|--------------------------------------------|--------------|
| **交易代码** | **userActivation**                                       |              |                                            |              |
| **接口备注** | 预开户状态用户进行支付密码信息设置，实现用户状态正常化。 |              |                                            |              |

信息查询
--------

### 客户基础信息

#### 客户信息查询（按用户号\|登录标识）

| **接口名称** | **客户信息查询（按用户号或用户标识）**                 | **接口编号** | **CIF-1004**                     |                |
|--------------|--------------------------------------------------------|--------------|----------------------------------|----------------|
| **交易代码** | queryCustInfoByUserId                                  |              |                                  |                |
| **接口备注** | 根据指定的用户号查询客户的基本信息、管理信息、证件信息 |              |                                  |                |
| **参数类型** | **名称**                                               | **属性**     | **业务规则**                     | **备注**       |
| 输入参数     | 用户号                                                 | 可选         |                                  | 二者必输其一   |
|              | 登录标识                                               | 可选         |                                  |                |
| 输出参数     | 执行结果                                               | 必选         |                                  | 成功、失败     |
|              | 失败原因                                               | （必）可选   |                                  | 失败情况下必选 |
|              | 用户号                                                 | 可选         |                                  |                |
|              | 信息对象                                               | 可选         | 包括基本信息、管理信息、证件信息 |                |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验**：

2.  **用户号、登录标识**必输其一校验，如果未上送提示“用户号、登录标识必输其一”（提示码：\${用户号、登录标识必输其一}）；

3.  **【CIF系统】进行业务校验：**

4.  如果上送了**用户号**、未上送**用户标识**，可直接获取**用户号**；

5.  如果上送了**用户标识**、未上送**用户号**，则先根据**用户标识**查询PER_个人用户标识表**[**PER_USER_LOGIN**]**，获取到**用户号**；

6.  如果都上送，则根据**用户号**查询；

7.  根据**用户号**查询PER_个人用户基本信息表**[**PER_USER**]**

8.  如果未获取到数据，则提示“用户不存在”（提示码：\$｛用户不存在｝）；

9.  如果用户状态**[**CLT_STA**]**为销户，则提示“用户已销户”（提示码：\${用户已销户}）；

10. 用户存在，检验**客户ID**是否为空（如果证件等信息不存在时不会创建客户）。如果为空，则提示“客户不存在”（提示码：\$｛客户不存在｝）。

11. **【CIF系统】进行业务处理：**

1）判断用户是否已识别，若未识别，则根据用户号查询客户信息临时表，获取客户相关信息。

2）若已识别，则

1.  获取**客户ID**；

    1.  根据**用户号**查询PER_个人用户基本信息表[PER_USER]，获取**客户ID**；

    2.  根据**用户标识**查询PER_个人用户标识表**[**PER_USER_LOGIN**]，**获取到**用户号**，然后再根据**用户号**查询PER_个人用户基本信息表[PER_USER]，获取**客户ID；**

2.  **如果查询标准信息，**根据**客户ID**分别查询PER_个人客户基本信息表**[**PER_Individual**]**、PER_客户管理信息表**[**PER_Management**]**、PER_联系电话表**[**PER_Contact_Phone**]**、PER_网络联系方式表**[**PER_Web_Contact**]、**PER_证件信息表**[**PER_Certificate**]**及PER_地址信息表**[**PER_ADDRESS**]**；

    1.  如果存在该客户联系信息，则返回给业务系统该客户的证件信息、联系信息（电话、网络、物理地址）列表和基本信息、管理信息对象；

    2.  如果不存在信息，则返回NULL。

3.  **如果查询简易信息，**根据客户ID和默认标识分别查询PER_个人客户基本信息表[PER_Individual]、PER_客户管理信息表[PER_Management]、PER_证件信息表**[**PER_Certificate**]**及PER_地址信息表[PER_ADDRESS]

    1.  如果存在该客户联系信息，则返回给业务系统该客户的证件信息、联系信息（物理地址）默认主信息；

    2.  如果不存在信息，则返回NULL。

4.  **【CIF系统】系统执行结果：**

5.  失败，则返回失败原因；

6.  成功，返回该客户的证件信息、基本信息、管理信息对象，列表字段详见对应表字段。

【结束流程】

#### 客户信息查询（按证件）

| **接口名称** | **客户信息查询（按证件）**                                                 | **接口编号** | **CIF-1005**                     |                |
|--------------|----------------------------------------------------------------------------|--------------|----------------------------------|----------------|
| **交易代码** | queryCustInfoByCtf                                                         |              |                                  |                |
| **接口备注** | 根据指定的证件国别、证件类型、证件号查询客户的基本信息、管理信息、证件信息 |              |                                  |                |
| **参数类型** | **名称**                                                                   | **属性**     | **业务规则**                     | **备注**       |
| 输入参数     | 证件国别                                                                   | 必选         |                                  |                |
|              | 证件类型                                                                   | 必选         |                                  |                |
|              | 证件号码                                                                   | 必选         |                                  |                |
| 输出参数     | 执行结果                                                                   | 必选         |                                  | 成功、失败     |
|              | 失败原因                                                                   | （必）可选   |                                  | 失败情况下必选 |
|              | 信息对象                                                                   | 可选         | 包括基本信息、管理信息、证件信息 |                |

**【业务处理流程】**

1.  【CIF系统】进行接口必输参数校验：

2.  检查业务系统是否上送了必选字段**证件国别、证件类型、证件号码**是否上送，如果未上送提示“接口输入参数缺失”（提示码：\${接口输入参数缺失}）；

3.  【CIF系统】进行业务校验：

>   根据**证件国别、证件类型、证件号码**查询PER_客户识别表**[**PER_Identification**]**

1.  如果未获取到数据，则提示“客户不存在”（提示码：\$｛客户不存在｝）；

2.  客户存在，根据**客户ID**查询PER_个人客户基本信息表**[**PER_Individual**]**，如果客户状态**[**CLT_STA**]**为销户，则提示“客户已销户”（提示码：\${客户已销户}）；

3.  【CIF系统】进行业务处理：

4.  根据**证件国别、证件类型、证件号码**查询PER_客户识别表[PER_Identification]，获取**客户ID**；

5.  **如果查询标准信息**,根据**客户ID**分别查询PER_个人客户基本信息表**[**PER_Individual**]**、PER_客户管理信息表**[**PER_Management**]**、PER_联系电话表**[**PER_Contact_Phone**]**、PER_网络联系方式表**[**PER_Web_Contact**]、**PER_证件信息表**[**PER_Certificate**]**及PER_地址信息表**[**PER_ADDRESS**]**；

    1.  如果存在该客户联系信息，则返回给业务系统该客户的证件信息、联系信息（电话、网络、物理地址）列表和基本信息、管理信息对象；

    2.  如果不存在信息，则返回NULL。

6.  **如果查询简易信息，**根据客户ID和默认标识分别查询PER_个人客户基本信息表[PER_Individual]、PER_客户管理信息表[PER_Management]、PER_证件信息表**[**PER_Certificate**]**及PER_地址信息表[PER_ADDRESS]

    1.  如果存在该客户联系信息，则返回给业务系统该客户的证件信息、联系信息（物理地址）默认主信息；

    2.  如果不存在信息，则返回NULL。

7.  【CIF系统】系统执行结果：

8.  失败，则返回失败原因；

9.  成功，返回该客户的证件信息、联系信息（电话、网络、物理地址）、列表集合和基本信息、管理信息对象，列表字段详见对应表字段。

【结束流程】

#### 客户信息鉴权

| **接口名称** | **客户信息鉴权** | **接口编号** |              |                |
|--------------|------------------|--------------|--------------|----------------|
| **交易代码** | authCustInfo     |              |              |                |
| **接口备注** |                  |              |              |                |
| **参数类型** | **名称**         | **属性**     | **业务规则** | **备注**       |
| 输入参数     | 用户号           | 必选         |              |                |
|              | 证件国别         | 必选         |              |                |
|              | 证件类型         | 必选         |              |                |
|              | 证件号码         | 必选         |              |                |
|              | 客户名称         | 必选         |              |                |
| 输出参数     | 执行结果         | 必选         |              | 成功、失败     |
|              | 失败原因         | （必）可选   |              | 失败情况下必选 |

**【业务处理流程】**

**1. 【CIF系统】进行接口必输参数校验：**

>   检查业务系统是否上送了必选字段**用户号、证件国别、证件类型、证件号码、客户名称**是否上送，如果未上送提示“接口输入参数缺失”（提示码：\${接口输入参数缺失}）；

**2. 【CIF系统】进行业务校验：**

校验用户号对应的用户是否存在，用户状态是否正常，校验用户是否已经实名，客户信息是否存在，客户状态是否正常。

**3. 【CIF系统】进行业务处理：**

根据用户号查询出客户信息，得到客户号，根据客户号查询识别表得到证件三要素、客户明名称，与上送的信息做比对，若不一致，则返客户信息鉴权失败。

**4. 【CIF系统】系统执行结果：**

1.  失败，则返回失败原因；

2.  成功，返回该客户的证件信息、联系信息（电话、网络、物理地址）、列表集合和基本信息、管理信息对象，列表字段详见对应表字段。

【结束流程】

### 用户基础信息

#### 用户基础信息查询

| **接口名称** | **查询用户的基本信息（用户号或用户标识）**                             | **接口编号** | **CIF-1006**                                                          |                |
|--------------|------------------------------------------------------------------------|--------------|-----------------------------------------------------------------------|----------------|
| **交易代码** | queryUserInfo                                                          |              |                                                                       |                |
| **接口备注** | 根据指定的用户号或者用户标识（昵称、主手机号、主邮箱）查询用户基础信息 |              |                                                                       |                |
| **参数类型** | **名称**                                                               | **属性**     | **业务规则**                                                          | **备注**       |
| 输入参数     | 用户号                                                                 | 可选         | 用户号与用户标识必选一个                                              |                |
|              | 用户标识                                                               | 可选         | 用户号与用户标识必选一个                                              |                |
| 输出参数     | 执行结果                                                               | 必选         |                                                                       | 成功、失败     |
|              | 失败原因                                                               | （必）可选   |                                                                       | 失败情况下必选 |
|              | 用户基础信息                                                           | 可选         | 用户基础信息UsertDto对象 包含用户安全级别userSafeSta 增加返回安全邮箱 |                |
|              | 用户管理信息                                                           | 可选         |                                                                       |                |
|              | 手机号                                                                 | 可选         |                                                                       |                |
|              | 邮箱                                                                   | 可选         |                                                                       |                |
|              | 客户姓名                                                               | 可选         |                                                                       |                |
|              | 证件号                                                                 |              |                                                                       |                |
|              | 证件类型                                                               |              |                                                                       |                |
|              | 证件国别                                                               |              |                                                                       |                |

**【业务处理流程】**

1.  【**CIF系统】进行接口必输参数校验：**

2.  检查业务系统是否上送了**用户号、用户标识**中任意一个，如果未上送提示“接口输入参数缺失”（提示码：\${接口输入参数缺失}）；

3.  **【CIF系统】进行业务校验：**

4.  如果上送了**用户号**、未上送**用户标识**，可直接获取**用户号**；

5.  如果上送了**用户标识**、未上送**用户号**，则先根据**用户标识**查询PER_个人用户标识表**[**PER_USER_LOGIN**]**，获取到**用户号**；

6.  如果都上送，则根据**用户号**查询；

7.  根据**用户号**查询PER_个人用户基本信息表**[**PER_USER**]**；

8.  如果未获取到数据，则提示“用户不存在”（提示码：\$｛用户不存在｝）；

9.  如果用户状态**[**CLT_STA**]**为销户，则提示“用户已销户”（提示码：\${用户已销户}）；

10. **【CIF系统】进行业务处理：**

11. 根据**用户号**查询**PER_个人用户基本信息表**，获取用户基本信息；

12. 根据**用户号**查询**PER_个人用户管理信息表**，获取用户管理信息（用户分组、用户等级、锁定状态、资金止付）；

13. 根据**用户号**查询**PER_个人用户登录标识**，获取用户登录标识（手机、邮箱、昵称）

14. 根据用户基本信息判断用户是否已识别，若未识别，则根据用户号查询客户信息临时表，得到客户姓名，证件三要素；若已识别，则得到客户号，根据客户号查询客户识别表，得到客户姓名及证件三要素；

15. 【**CIF系统】系统执行结果：**

16. 失败，则返回失败原因；

17. 成功，返回该用户的基础信息。

【结束流程】

#### 用户标识查询

| **接口名称** | **查询用户标识（用户号或用户标识）**                                       | **接口编号** | **CIF-1007**             |                |
|--------------|----------------------------------------------------------------------------|--------------|--------------------------|----------------|
| **交易代码** | queryLoginId                                                               |              |                          |                |
| **接口备注** | 根据指定的用户号或者用户标识（昵称、主手机号、主邮箱）查询用户所有标识信息 |              |                          |                |
| **参数类型** | **名称**                                                                   | **属性**     | **业务规则**             | **备注**       |
| 输入参数     | 用户号                                                                     | 可选         | 用户号与用户标识必选一个 |                |
|              | 用户标识                                                                   | 可选         | 用户号与用户标识必选一个 |                |
| 输出参数     | 执行结果                                                                   | 必选         |                          | 成功、失败     |
|              | 失败原因                                                                   | （必）可选   |                          | 失败情况下必选 |
|              | 用户标识                                                                   | 可选         | List\<String\>           |                |

**【业务处理流程】**

1.  【**CIF系统】进行接口必输参数校验：**

2.  检查业务系统是否上送了**用户号、用户标识**中任意一个，如果未上送提示“接口输入参数缺失”（提示码：\${接口输入参数缺失}）；

3.  **【CIF系统】进行业务校验：**

4.  如果上送了**用户号**、未上送**用户标识**，可直接获取**用户号**；

5.  如果上送了**用户标识**、未上送**用户号**，则先根据**用户标识**查询PER_个人用户标识表**[PER**\_USER_LOGIN**]**，获取到**用户号**；

6.  如果都上送，则根据**用户号**查询；

7.  根据**用户号**查询PER_个人用户基本信息表**[P**ER_USER**]**；

8.  如果用户状态**[**CLT_STA**]**为销户，则提示“用户已销户”（提示码：\${用户已销户}）；

9.  **【CIF系统】进行业务处理：**

>   根据**用户号**查询PER_个人用户标识表**[**PER_USER_LOGIN**]**，获取该用户标识；

1.  **【CIF系统】系统执行结果：**

2.  失败，则返回失败原因；

3.  成功，返回该用户所有标识信息。

【结束流程】

#### 用户标识查询(托管平台)

| **接口名称** | **用户标识查询（托管平台）**              | **接口编号** | **CIF-1008** |                |
|--------------|-------------------------------------------|--------------|--------------|----------------|
| **交易代码** | queryLoginIdFcp                           |              |              |                |
| **接口备注** | 根据指定的PID和手机号查询第三方登录标识表 |              |              |                |
| **参数类型** | **名称**                                  | **属性**     | **业务规则** | **备注**       |
| 输入参数     | 手机号                                    | 必选         |              |                |
|              | PID                                       | 必选         |              |                |
| 输出参数     | 执行结果                                  | 必选         |              | 成功、失败     |
|              | 失败原因                                  | （必）可选   |              | 失败情况下必选 |
|              | 主账户用户号                              | 可选         |              |                |
|              | 托管账户用户号                            | 可选         |              |                |

**【业务处理流程】**

**1. 【CIF系统】进行接口必输参数校验：**

>   A.
>   检查业务系统是否上送了**手机号、PID**必输校验，如果未上送提示“接口输入参数缺失”（提示码：\${接口输入参数缺失}）；

2. **【CIF系统】进行业务处理：**

根据手机号PER_登录标识表，若没有查询到信息，则直接返回成功，若查询到信息，则得到用户号，根据用户号和PID查询业务订购关系表，若未查询到数据，则返回主账户的用户号，若查询数据则返回主账户的用户号和托管账户的用户号；

**3. 【CIF系统】系统执行结果：**

A. 失败，则返回失败原因；

B. 成功，返回该用户所有标识信息。

【结束流程】

#### 客户下所有用户基本信息及标识查询

| 接口名称     | 客户下所有用户基本信息及标识查询                                                      | 接口编号   |                                                     |                                    |
|--------------|---------------------------------------------------------------------------------------|------------|-----------------------------------------------------|------------------------------------|
| 交易代码     | queryAllUserNoUserIdentity                                                            |            |                                                     |                                    |
| **接口备注** | 可以根据用户号、客户号，证件三要素+客户名称的组合查询客户的所有用户基本信息及标识信息 |            |                                                     |                                    |
| **参数类型** | **名称**                                                                              | **属性**   | **业务规则**                                        | **备注**                           |
| 输入参数     | 客户号                                                                                | 可选       | 客户号、用户号、证件三要素+客户名称必选一个         | 查询顺序：客户号、用户号、证件信息 |
|              | 用户号                                                                                | 可选       | 客户号、用户号、证件三要素+客户名称必选一个         | 查询顺序：客户号、用户号、证件信息 |
|              | 客户名称                                                                              | 可选       |                                                     | 四者同时选输                       |
|              | 证件类型                                                                              | 可选       |                                                     |                                    |
|              | 证件号码                                                                              | 可选       |                                                     |                                    |
|              | 证件国别                                                                              | 可选       |                                                     |                                    |
| 输出参数     | 执行结果                                                                              | 必选       |                                                     | 成功、失败                         |
|              | 失败原因                                                                              | （必）可选 |                                                     | 失败情况下必选                     |
|              | 用户信息                                                                              | 可选       | 对象包含用户基本信息和用户标识列表 增加返回安全邮箱 |                                    |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数及其合法性校验：**

2.  若客户号、用户号、证件三要素+客户名称都未上送（或上送不全），则报参数缺失异常；

3.  若客户号上送，则校验客户是否存在，是否销户；

4.  若客户号未上送，用户号上送，则校验用户是否存在，是否销户，其客户是否存在，是否销户，获取客户号；

5.  若客户号、用户号均未上送，证件信息上送，则根据证件信息查询识别表，校验证件信息是否存在，若存在，获取客户号；

6.  **【CIF系统】查询用户信息及用户标识**

7.  通过**客户号**查询PER_个人用户基本信息表**[**PER_USER**]**获取客户下所有用户的用户基本信息，通过用户基本信息中的用户号查询PER_个人用户标识表**[**PER_USER_LOGIN**]**获取所有用户的标识信息；返回；

8.  **【CIF系统】系统执行结果：**

9.  失败，则返回失败原因；

10. 成功，返回所有用户基本信息和用户所有标识信息。

【结束流程】

### 余额查询

#### 余额查询

| **接口名称** | 余额查询         | **接口编号** | **CIF-1009** |            |
|--------------|------------------|--------------|--------------|------------|
| **交易代码** | **queryUserBal** |              |              |            |
| **接口备注** | 1.查询用户余额   |              |              |            |
| **参数类型** | **名称**         | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号           | 可选         |              |            |
| 输出参数     | 执行结果         | 必选         |              | 成功、失败 |
|              | 失败原因         | 可选         |              |            |
|              | 用户号           | 可选         |              |            |
|              | 可用金额         | 可选         |              |            |
|              | 冻结金额         | 可选         |              |            |
|              | 不可提现金额     | 可选         |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证用户是否存在（通过用户标识获取用户号不需要此验证）**

5.  通过用户号查询PER_个人用户基本信息；

6.  如果结果为空，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

7.  如果用户状态为“销户”，则提示“用户已销户”异常（异常码：\$｛用户已销户｝）；

8.  **【CIF系统】用户余额查询，根据用户号查询账户余额相关表，得到可用余额、冻结金额、不可提现金额等。**

9.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因，返回账户可用余额、冻结金额、不可提现金额。

【结束流程】

信息更新
--------

### 客户基础信息

#### 客户信息维护

| **接口名称** | **客户信息维护**   | **接口编号** | **CIF-1010** |            |
|--------------|--------------------|--------------|--------------|------------|
| **交易代码** | **updateCustInfo** |              |              |            |
| **接口备注** |                    |              |              |            |
| **参数类型** | **名称**           | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号             | 必选         |              |            |
|              | 客户姓名           | 必选         |              |            |
|              | 证件号             | 必选         |              |            |
|              | 证件类型           | 必选         |              |            |
|              | 证件国别           | 必选         |              |            |
|              | 性别               | 可选         |              |            |
| 输出参数     | 执行结果           | 必选         |              | 成功、失败 |
|              | 失败原因           | 必选         |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行用户号、客户姓名、证件号、证件类型、证件国别、性别校验。

3.  **【CIF系统】进行业务校验与预处理**：

4.  **进行用户状态校验**

通过公共组件确认要激活的用户状态是否正常、如果不正常，按公共组件抛出的异常进行抛出。判断用户是否已识别，若用户已识别，提示“已识别客户不允许信息修改”异常（异常码：\$｛已识别客户不允许信息修改｝）；

1.  **【CIF系统】检查用户上送的支付密码是否正确**

>   检查用户的**支付密码**是否正确，根据用户号查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

1.  **【CIF系统】进行证件新增**

2.  A.
    根据用户号查询客户信息临时表，判断临时区证件是否存在，若不存在，则新增证件信息，若已存在，则更新证件信息；

3.  【CIF系统返回执行结果】

>   如果失败，则返回失败原因。

【结束流程】

#### 实名认证

| **接口名称** | **实名认证**                       | **接口编号** | **CIF-1011** |                |
|--------------|------------------------------------|--------------|--------------|----------------|
| **交易代码** | realNameAuth                       |              |              |                |
| **接口备注** | 将客户实名级别或认证状态由低改为高 |              |              |                |
| **参数类型** | **名称**                           | **属性**     | **业务规则** | **备注**       |
|              | 用户号                             | 必选         |              |                |
|              | 客户姓名                           | 必选         |              |                |
|              | 证件国别                           | 必选         |              |                |
|              | 证件类型                           | 必选         |              |                |
|              | 证件号码                           | 必选         |              |                |
|              | 认证方式                           | 必选         |              |                |
|              | 银行卡号                           | 必选         |              |                |
|              | 开户行                             | 必选         |              |                |
|              | 卡类型                             | 必选         |              |                |
|              | 银行预留手机号                     | 必选         |              |                |
| 输出参数     | 执行结果                           | 必选         |              | 成功、失败     |
|              | 失败原因                           | 可选         |              | 失败情况下必选 |
|              | 客户号                             | 必选         |              |                |
|              | 客户实名状态                       | 必选         |              |                |
|              | 快捷协议号                         | 必选         |              |                |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

检查业务系统是否上送了必选字段用户Id、客户姓名、证件国别、证件类型、证件号码、银行卡号、开户行、卡类型、银行预留手机号，是否上送，如果未上送提示“接口输入参数缺失”异常（异常码：\${接口输入参数缺失}）；

1.  **【CIF系统】进行业务校验：**

根据上送用户号，查询用户表[PER_USER]判断是否已实名，如果已实名，a.校验客户及用户状态，b.校验上送证件四要素与既存客户的证件三要素是否一致，如果不一致，则提示“证件信息与既存客户证件信息不一致”异常（异常码：\${证件信息与既存客户证件信息不一致}），通过后进入下述4绑卡流程；如果未实名，校验用户状态，通过后进入下述3实名流程。

1.  **【CIF系统】实名认证：**

2.  根据上送的证件三要素，查询客户识别表[PER_IDENTIFICATION]，如果证件已被实名，则提示“证件已被实名认证，请进行客户归并操作”异常（异常码：\${证件已被实名认证，请进行客户归并操作}）；

3.  如果证件未被实名，生成客户信息[PER_INDIVIDUAL]，客户识别信息[PER_IDENTIFICATION]，证件信息[PER_CERTIFICATE]，并返回客户号。

4.  **【CIF系统】银行卡绑定：**

    1.  根据银行卡号查询客户银行卡信息表[PER_BANK_CARD]，如果银行卡已被绑定，判断所绑定的客户号与当前用户客户号是否相同，如果不同，则提示“银行卡已被其他客户绑定”异常（异常码：\${银行卡已被其他客户绑定}），否则进入下述B流程；如果银行卡未被绑定，直接进入下述B流程。

    2.  生成客户银行卡信息[PER_BANK_CARD]，为用户订购快捷协议[PER_BIZ_CARD_BIND]。

5.  **【CIF系统】记录实名认证过程：**

>   记录实名认证过程信息[PER_AUTHENTICATION]。

1.  **【CIF系统】登记关键事件登记表**

2.  **【CIF系统】返回执行结果**

【结束流程】

### 用户基础信息

#### 用户标识更新（手机号、邮箱）

| **接口名称** | **用户标识更新**（手机号、邮箱） | **接口编号** | **CIF-1012**       |                                  |
|--------------|----------------------------------|--------------|--------------------|----------------------------------|
| **交易代码** | **updateLoginId**                |              |                    |                                  |
| **接口备注** | 设置用户登录标识（手机号、邮箱） |              |                    |                                  |
| **参数类型** | **名称**                         | **属性**     | **业务规则**       | **备注**                         |
| 输入参数     | 用户号                           | 必选         |                    |                                  |
|              | 登录类型                         | 必选         |                    |                                  |
|              | 登录标识                         | 必选         |                    | 手机号、邮箱                     |
|              | 支付密码                         | 必选         |                    |                                  |
|              | 同步安全标识                     | 可选         | 默认不同步0，同步1 | 是否同步修改安全手机或者安全邮箱 |
|              | 验证码回执编号                   | 可选         |                    | 同时选输                         |
|              | 验证码                           | 可选         |                    |                                  |
| 输出参数     | 执行结果                         | 必选         |                    | 成功、失败                       |
|              | 失败原因                         | （必）可选   |                    |                                  |

1.  如果有手机号变更，则要进行用户级的协议校验

2.  对已存在的更新，不存在的新增

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号、登录类型、登录标识、支付密码**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  **校验手机号\|邮箱是否被占用**：

>   通过查询*用户标识表（用户标识字段）*，确认手机号\|邮箱是否已经存在

1.  如果登录类型为手机，则进行手机号检验：如果存在则提示“手机号已注册”异常，（异常码：\$｛用户手机号已存在｝）；

2.  如果登录类型为邮箱，则进行邮箱检验：如果邮箱已经存在，则提示“邮箱已经被占用”异常（异常码：\$｛邮箱被占用｝）。

3.  **如果修改手机号，则进行短信验证码校验：**

>   **校验短信验证码的有效性：获取用户的安全手机，通过查询短信验证码信息表
>   以安全手机号、短信验证码编号为查询条件，与CIF系统短信验证码存留信息进行比对：**

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

    1.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

3.  **如果修改邮箱，则进行邮箱验证码验证**

>   校验邮件验证码的有效性：通过查询*邮件验证码信息表*
>   以**邮箱、邮件验证码编号**为查询条件，与CIF系统邮件验证码存留信息进行比对

1.  如果没有相应记录，则提示“邮件验证码非法”异常（异常码：\${邮件验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

    1.  如果无效，则提示“邮件验证码已失效”异常（异常码：\${邮件验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“邮件验证码错误”异常（异常码：\${邮件验证码错误}）

3.  **【CIF系统】进行支付密码校验；**

>   检查用户的**支付密码**是否被锁定

1.  如果锁定，则报“支付密码已锁定”异常（异常码：\${支付密码已锁定}）；

2.  如果没有锁定，检查用户的**支付密码**和在【PER_个人用户支付密码表】中的支付密码是否一致，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

3.  **【CIF系统】如果用户手机号码标识有修改，则进行用户级的协议校验；**

>   根据用户的**手机号码**查询PER_用户协议订购表，如果用户签署了协议，则需要查询用户所签署的协议是否都允许修改此业务，如果不可以，则提示“此用户有签订业务，无法修改”异常（异常码：\${此用户有签订业务，无法修改}）

1.  **【CIF系统】进行用户标识更新**

更新用户标识（*个人用户标识表*），对原有的标识进行更新；

**判断是否修改安全手机或者邮箱标识，进行**更新用户安全手机或者安全邮箱(用户基
本信息表)；

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】登记系统事件登记表**

3.  **【CIF系统】发送短信通知（如果修改手机号，则新老手机号均要发送短信通知）**

4.  通过**用户号、标识类型**，查询**PER_个人用户登录标识**，获得手机号

5.  通过业务获取短信模板，拼装短信内容

6.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

7.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

>   【结束流程】

#### 用户标识更新（实名信息验证）

| **接口名称** | **用户标识更新**（实名信息验证） | **接口编号** | **CIF-1013** |            |
|--------------|----------------------------------|--------------|--------------|------------|
| **交易代码** | **updateLoginIdByRealInfo**      |              |              |            |
| **接口备注** |                                  |              |              |            |
| **参数类型** | **名称**                         | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号                           | 必选         |              |            |
|              | 客户姓名                         | 必选         |              |            |
|              | 证件类型                         | 必选         |              |            |
|              | 证件号                           | 必选         |              |            |
|              | 证件国别                         | 必选         |              |            |
|              | 银行卡号                         | 必选         |              |            |
|              | 预留手机号                       | 必选         |              |            |
|              | 登录标识                         | 必选         |              |            |
|              | 标识类型                         | 必选         |              |            |
|              | 验证码回执编号                   | 必选         |              |            |
|              | 验证码                           | 必选         |              |            |
|              | 同步安全手机标识                 | 可选         |              |            |
| 输出参数     | 执行结果                         | 必选         |              | 成功、失败 |
|              | 失败原因                         | 可选         |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

    1.  【CIF系统】进行**用户号、客户实名信息、登录标识、标识类型**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

2.  **【CIF系统】进行业务校验：**

    1.  **验证锁定规则，详情见附录锁定规则**

    2.  **校验手机号\|邮箱是否被占用**：

>   通过查询*用户标识表（用户标识字段）*，确认手机号\|邮箱是否已经存在

1.  如果登录类型为手机，则进行手机号检验：如果存在则提示“手机号已注册”异常，（异常码：\$｛用户手机号已存在｝）；

2.  如果登录类型为邮箱，则进行邮箱检验：如果邮箱已经存在，则提示“邮箱已经被占用”异常（异常码：\$｛邮箱被占用｝）。

3.  **如果修改手机号，则进行短信验证码校验：**

>   **校验短信验证码的有效性：通过查询短信验证码信息表
>   以上送手机、短信验证码编号为查询条件，与CIF系统短信验证码存留信息进行比对：**

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

    1.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

3.  **如果修改邮箱，则进行邮箱验证码验证**

>   校验邮件验证码的有效性：通过查询*邮件验证码信息表*
>   以**邮箱、邮件验证码编号**为查询条件，与CIF系统邮件验证码存留信息进行比对

1.  如果没有相应记录，则提示“邮件验证码非法”异常（异常码：\${邮件验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

    1.  如果无效，则提示“邮件验证码已失效”异常（异常码：\${邮件验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“邮件验证码错误”异常（异常码：\${邮件验证码错误}）

3.  **【CIF系统】进行实名信息校验；**

>   检查用户的实名信息是否准确;

1.  如果错误，则报“实名信息错误”异常（异常码：\${实名信息错误}）；

2.  **【CIF系统】如果用户手机号码标识有修改，则进行用户级的协议校验；**

>   根据用户的**手机号码**查询PER_用户协议订购表，如果用户签署了协议，则需要查询用户所签署的协议是否都允许修改此业务，如果不可以，则提示“此用户有签订业务，无法修改”异常（异常码：\${此用户有签订业务，无法修改}）

1.  **【CIF系统】进行用户标识更新**

更新用户标识（*个人用户标识表*），对原有的标识进行更新；

**判断是否修改安全手机或者邮箱标识，进行**更新用户安全手机或者安全邮箱(用户基
本信息表)；

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】登记系统事件登记表**

3.  **【CIF系统】发送短信通知（如果修改手机号，则新老手机号均要发送短信通知）**

4.  通过**用户号、标识类型**，查询**PER_个人用户登录标识**，获得手机号

5.  通过业务获取短信模板，拼装短信内容

6.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

7.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

>   【结束流程】

#### 用户信息更新（头像，昵称）

| **接口名称** | **用户信息更新（头像，昵称）** | **接口编号** | **CIF-1014** |            |
|--------------|--------------------------------|--------------|--------------|------------|
| **交易代码** | **updateUserInfo**             |              |              |            |
| **接口备注** | 修改用户昵称，头像等基本信息   |              |              |            |
| **参数类型** | **名称**                       | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号                         | 必选         |              |            |
|              | 昵称                           | 可选         |              |            |
|              | 头像                           | 可选         |              |            |
| 输出参数     | 执行结果                       | 必选         |              | 成功、失败 |
|              | 失败原因                       | 可选         |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

    1.  【CIF系统】进行**用户号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

2.  **【CIF系统】进行业务校验：**

    1.  **验证锁定规则，详情见附录锁定规则**

    2.  根据上送的用户号验证用户是否存在，如果不存在，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

3.  **【CIF系统】如果用户上送了昵称或者头像**

根据用户号更新用户的基本信息;

1.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

>   【结束流程】

### 安全信息

#### 登录密码修改

| **接口名称** | **登录密码修改**                       | **接口编号** | **CIF-1015** |            |
|--------------|----------------------------------------|--------------|--------------|------------|
| **交易代码** | **updateLoginPwd**                     |              |              |            |
| **接口备注** | 通过验证用户原登录密码修改用户登录密码 |              |              |            |
| **参数类型** | **名称**                               | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号                                 | 必选         |              |            |
|              | 原登录密码                             | 必选         |              |            |
|              | 新登录密码                             | 必选         |              |            |
|              | 手机短信验证码回执编号                 | 可选         |              | 同时选输   |
|              | 手机验证码                             | 可选         |              |            |
| 输出参数     | 执行结果                               | 必选         |              | 成功、失败 |
|              | 失败原因                               | （必）可选   |              |            |

1.  同一用户的登录密码与支付密码不能相同

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号，原登录密码，新登录密码**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  **业务系统上送的新登录密码不能和现有的支付密码相同；**

>   通过**用户号**查询**个人用户支付密码表**，比较用户的**支付密码**和最新登录是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

1.  **如果业务系统上送了短信验证码编号与短信验证码，则进行短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、短信验证码编号**为查询条件，与CIF系统短信验证码存留信息进行比对：

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中）），

3.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

4.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

5.  **【CIF系统】检查用户上送的原登录密码是否正确；**

>   检查用户的**原登录密码**是否正确，根据用户号查询用户登录密码，和上送的登录密码比较，如果不一致，则报“登录密码错误”异常（异常码：\${登录密码错误}）

1.  **【CIF系统】进行登录密码修改**

根据用户号和密码类型对登录密码进行修改，更新**个人用户登录密码表**信息

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】发送短信通知**

3.  通过**用户号**查询**PER_个人用户基本信息**，获得安全手机号

4.  通过业务获取短信模板，拼装短信内容

5.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

6.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

>   【结束流程】

#### 登录密码重置(通过支付密码)

| **接口名称** | **登录密码重置(通过支付密码)**                                                  | **接口编号** | **CIF-1016** |            |
|--------------|---------------------------------------------------------------------------------|--------------|--------------|------------|
| **交易代码** | **resetLoginPwd**                                                               |              |              |            |
| **接口备注** | 1.通过验证用户支付密码来重置用户登录密码 2.同一用户的登录密码与支付密码不能相同 |              |              |            |
| **参数类型** | **名称**                                                                        | **属性**     | **业务规则** | **备注**   |
|              | 用户标识                                                                        | 必选         |              |            |
|              | 支付密码                                                                        | 必选         |              |            |
|              | 新登录密码                                                                      | 必选         |              |            |
|              | 手机短信验证码回执编号                                                          | 可选         |              | 同时选输   |
|              | 手机验证码                                                                      | 可选         |              |            |
| 输出参数     | 执行结果                                                                        | 必选         |              | 成功、失败 |
|              | 失败原因                                                                        | 可选         |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户标识，支付密码,新登录密码**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  根据用户标识查询PER_个人用户标识表[PER_USER_LOGIN]，获取到用户号；

6.  **业务系统上送的新登录密码不能和现有的支付密码相同；**

>   通过**用户号**查询**个人用户支付密码表**，比较用户的**支付密码**和最新登录是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

1.  **如果业务系统上送了短信验证码编号与短信验证码，则进行短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、短信验证码编号**为查询条件，与CIF系统短信验证码存留信息进行比对：

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））；

    1.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

3.  **【CIF系统】检查用户上送的支付密码是否正确；**

>   检查用户的**支付密码**是否正确，根据用户号查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

1.  **【CIF系统】进行登录密码修改**

根据用户号和密码类型对登录密码进行修改，更新**个人用户登录密码表**信息

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】登记系统事件登记表**

3.  **【CIF系统】发送短信通知**

4.  通过**用户号**查询**PER_个人用户基本信息**，获得安全手机号

5.  通过业务获取短信模板，拼装短信内容

6.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

7.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

#### 登录密码重置(通过手机动态验证码)

| **接口名称** | 登录密码重置(通过手机动态验证码) | **接口编号** | **CIF-1017** |              |
|--------------|----------------------------------|--------------|--------------|--------------|
| **交易代码** | **resetLoginPwdByPhone**         |              |              |              |
| **接口备注** |                                  |              |              |              |
| **参数类型** | **名称**                         | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户标识                         | 必选         |              |              |
|              | 新登录密码                       | 必选         |              |              |
|              | 短信验证码编号                   | 必选         |              |              |
|              | 短信验证码                       | 必选         |              |              |
|              | 证件号码                         | 可选         |              | 三者同时选输 |
|              | 证件类型                         | 可选         |              |              |
|              | 证件国别                         | 可选         |              |              |
| 输出参数     | 执行结果                         | 必选         |              | 成功、失败   |
|              | 失败原因                         | 可选         |              |              |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户标识、新登录密码、短信验证码、短信验证码编号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  先根据用户标识查询PER_个人用户标识表[PER_USER_LOGIN]，获取到用户号；

6.  **业务系统上送的新登录密码不能和现有的支付密码相同；**

>   通过**用户号**查询**个人用户支付密码表**，比较用户的**支付密码**和最新登录是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

1.  **进行短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、短信验证码编号**为查询条件，与CIF系统短信验证码存留信息进行比对：

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））；

    1.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

3.  **【CIF系统】进行登录密码修改**

根据用户号和密码类型对登录密码进行修改，更新**个人用户登录密码表**信息

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】登记系统事件登记表**

3.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

#### 登录密码重置(客服最高权限)

| **接口名称** | **登录密码重置(客服最高权限)**                                                | **接口编号** |              |              |
|--------------|-------------------------------------------------------------------------------|--------------|--------------|--------------|
| **交易代码** | **coerceResetLoginPwd**                                                       |              |              |              |
| **接口备注** | 1.打客服电话来重置用户登录密码 2.密码重置成6个0，客服告之，并提醒及时修改密码 |              |              |              |
| **参数类型** | **名称**                                                                      | **属性**     | **业务规则** | **备注**     |
|              | 用户标识                                                                      |              |              | 二者必输其一 |
|              | 用户号                                                                        |              |              |              |
|              | 新登录密码                                                                    | 必选         |              |              |
| 输出参数     | 执行结果                                                                      | 必选         |              | 成功、失败   |
|              | 失败原因                                                                      | 可选         |              |              |

**【业务处理流程】**

**1. 【CIF系统】进行接口必输参数校验：**

>   A.
>   【CIF系统】进行**新登录密码、用户标识\|用户号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

**2. 【CIF系统】进行业务校验：**

>   **A. 验证锁定规则，详情见附录锁定规则**

>   **B. 业务系统上送的新登录密码不能和现有的支付密码相同；**

>   通过**用户号**查询**个人用户支付密码表**，比较用户的**支付密码**和最新登录是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

**3. 【CIF系统】进行登录密码重置**

根据用户号和密码类型将登录密码重置成6个0，更新**个人用户登录密码表**信息；

**4. 【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

**5. 【CIF系统】登记系统事件登记表**

**6. 【CIF系统】发送短信通知**

A. 通过**用户号**查询**PER_个人用户基本信息**，获得安全手机号

>   B. 通过业务获取短信模板，拼装短信内容

>   C.
>   调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

1.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

#### 支付密码修改

| **接口名称** | **支付密码修改**                                                                                                           | **接口编号** | **CIF-1018** |            |
|--------------|----------------------------------------------------------------------------------------------------------------------------|--------------|--------------|------------|
| **交易代码** | **updatePayPwd**                                                                                                           |              |              |            |
| **接口备注** | 1.通过验证用户原支付密码修改用户支付密码 2.同一用户的登录密码与支付密码不能相同 3. 用户锁定状态下（锁定状态 \> 0）不可用。 |              |              |            |
| **参数类型** | **名称**                                                                                                                   | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号                                                                                                                     | 必选         |              |            |
|              | 原支付密码                                                                                                                 | 必选         |              |            |
|              | 新支付密码                                                                                                                 | 必选         |              |            |
|              | 手机短信验证码回执编号                                                                                                     | 可选         |              | 同时选输   |
|              | 手机验证码                                                                                                                 | 可选         |              |            |
| 输出参数     | 执行结果                                                                                                                   | 必选         |              | 成功、失败 |
|              | 失败原因                                                                                                                   | （必）可选   |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号，原支付密码,新支付密码**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  验证锁定规则，详情见附录锁定规则

5.  **业务系统上送的新支付密码不能和现有的登录密码相同；**

>   通过**用户号**查询**个人用户登录密码表**，比较用户的最新**支付密码**和登录密码是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

1.  **如果业务系统上送了短信验证码编号与短信验证码，则进行短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、短信验证码编号**为查询条件，与CIF系统短信验证码存留信息进行比对：

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

3.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

4.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

5.  **【CIF系统】检查用户上送的原支付密码是否正确；**

>   检查用户的**原支付密码**是否正确，根据用户号查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

1.  **【CIF系统】进行登录密码修改**

根据用户号和支付密码类型对支付密码进行修改，更新**个人用户支付密码表**信息

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】发送短信通知**

3.  通过**用户号**查询**PER_个人用户基本信息**，获得安全手机号

4.  通过业务获取短信模板，拼装短信内容

5.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

6.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

#### 支付密码重置（通过实名认证绑定的银行卡）

| **接口名称** | **支付密码重置**                                                                                                               | **接口编号** | **CIF-1019** |            |
|--------------|--------------------------------------------------------------------------------------------------------------------------------|--------------|--------------|------------|
| **交易代码** | **resetPayPwdByCard**                                                                                                          |              |              |            |
| **接口备注** | 1.通过验证用户安全问题与答案重置用户支付密码 2.同一用户的登录密码与支付密码不能相同 3. 用户锁定状态下（锁定状态 \> 0）不可用。 |              |              |            |
| **参数类型** | **名称**                                                                                                                       | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号                                                                                                                         | 必选         |              |            |
|              | 客户名称                                                                                                                       | 必选         |              |            |
|              | 证件号                                                                                                                         | 必选         |              |            |
|              | 证件类型                                                                                                                       | 必选         |              |            |
|              | 证件国别                                                                                                                       | 必选         |              |            |
|              | 银行卡号                                                                                                                       | 必选         |              |            |
|              | 银行预留手机号                                                                                                                 | 必选         |              |            |
|              | 手机短信验证码回执编号                                                                                                         | 必选         |              | 同时选输   |
|              | 手机验证码                                                                                                                     | 必选         |              |            |
|              | 新支付密码                                                                                                                     | 必选         |              |            |
| 输出参数     | 执行结果                                                                                                                       | 必选         |              | 成功、失败 |
|              | 失败原因                                                                                                                       | （必）可选   |              |            |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**必选参数**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  **如果上送了用户标识、未上送用户号，则先根据用户标识查询PER_个人用户标识表[PER_USER_LOGIN]，获取到用户号；**

6.  **业务系统上送的新支付密码不能和现有的登录密码相同；**

>   通过**用户号**查询**个人用户登录密码表**，比较用户的最新**支付密码**和登录密码是否一致，如果一致则提示“登录密码不能和支付密码一致”异常（异常码：\${登录密码不能和支付密码一致}）。

1.  **检查用户上送的银行卡等信息是否正确**；

>   通过用户号，银行卡号查询**客户银行卡信息表，**获取用户的银行卡信息与上送的相关银行卡信息进行比对**，**如果上送的银行卡信息有误，则提示“银行卡信息不一致”异常（异常码：\${银行卡信息错误}）

1.  **检查客户证件信息是否正确**；

>   通过用户号查出用户的证件信息，与上送的证件信息进行比对，如果信息不一致，则提示“证件信息错误”异常（异常码：\${证件信息错误}）

1.  **进行短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、短信验证码编号**为查询条件，与CIF系统短信验证码存留信息进行比对

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中））

    1.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

    2.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

3.  **【CIF系统】进行支付密码重置**

根据用户号和支付密码类型对支付密码进行修改，更新**个人用户支付密码表**信息

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】登记系统事件登记表**

3.  **【CIF系统】发送短信通知**

4.  通过**用户号**查询**PER_个人用户基本信息**，获得安全手机号

5.  通过业务获取短信模板，拼装短信内容

6.  调用短信发送接口，发送短信（短信发送失败不影响业务，接口中已实现重发机制）

7.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

销户
----

### 用户销户

| **接口名称** | **用户销户**  | **接口编号** | **CIF-1020** |            |
|--------------|---------------|--------------|--------------|------------|
| **交易代码** | **closeUser** |              |              |            |
| **接口备注** |               |              |              |            |
| **参数类型** | **名称**      | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 用户号        | 必选         |              |            |
|              | 销户原因      | 必选         |              |            |
|              | 操作员        | 可选         |              |            |
|              | 授权操作员    | 可选         |              |            |
| 输出参数     | 执行结果      | 必选         |              | 成功、失败 |
|              | 失败原因      | 可（必）选   |              |            |
|              | 用户号        | 必选         |              |            |
|              | 用户状态      | 必选         |              |            |

**【业务处理流程】**

1.  【CIF系统】进行接口必输参数校验：

>   检查业务系统是否上送了必选字段**用户号、销户原因、柜员号、授权柜员号**是否上送，如果未上送提示“接口输入参数缺失”异常（异常码：\${接口输入参数缺失}）；

1.  【CIF系统】进行业务校验：

>   根据用户**ID**查询PER_个人用户基本信息表

1.  如果用户不存在，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

2.  如果用户状态**[**CUST_STA**]**为销户，则提示“用户已销户”异常（异常码：\${用户已销户}）。

3.  【CIF系统】验证用户签约协议是否允许销户：

4.  根据用户的**用户Id**查询PER_用户协议订购表，如果用户签署了协议，则需要查询用户所签署的协议是否都允许删除此业务，如果不可以，则提示“此用户有签订业务，无法销户”异常（异常码：\${此用户有签订业务，无法销户}）。

5.  【CIF系统】查询用户资金账户是否存在余额

6.  通过**用户号、业务状态（1-正常）**查询**PER_用户业务订购关系和PER远程支付业务订购**，判断是否存在远程业务订购业务

7.  如果存在则通过用户号调用账务系统账户明细余额查询(00902)接口，通过上一步查询获得的个人现金账户账号、（如果存在一卡充账户账号）分别从查询结果中获取账户的余额和账户状态；

8.  如果余为零且账户状态为（1-正常）则调用账务系统销户(00102)，否则提示“此用户账户余额不为零，无法销户”异常（异常码：\${此用户账户余额不为零，无法销户}）（如果账户已经销户，则跳过即可，无需报错）

9.  解除用户下所有协议

10. 更新PER_个人用户基本信息表，更新用户状态为销户,删除用户下所有登录标识

11. 【CIF系统】进行维护日志登记：

>   记录维护日志表【BASE_维护日志：BASE_TRANSCATION】，并根据上述操作实体，相应记录维护明细信息【BASE_维护明细：BASE_TRANSCATION_DETAIL】。

1.  【CIF系统】登记系统事件登记表

2.  【CIF系统】系统执行结果：

3.  失败，则返回失败原因；

4.  成功，返回成功状态码。

【结束流程】

协议管理
--------

### 用户级业务

#### 银行卡绑定

##### 银行卡协议绑定

| **接口名称** | **银行卡绑定**      | **接口编号** | **CIF-1021** |              |
|--------------|---------------------|--------------|--------------|--------------|
| **交易代码** | **bindBankCardAgr** |              |              |              |
| **接口备注** |                     |              |              |              |
| **参数类型** | **名称**            | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户号              | 可选         |              | 两者必输其一 |
|              | 用户标识            | 可选         |              |              |
|              | 业务类型            | 必选         |              |              |
|              | 银行卡序号          | 必选         |              |              |
|              | 支付密码            | 必选         |              |              |
|              | 短信回执编号        | 可选         |              |              |
|              | 手机短信验证码      | 可选         |              |              |
| 输出参数     | 执行结果            | 必选         |              | 成功、失败   |
|              | 失败原因            | 必选         |              |              |
|              | 用户号              | 必选         |              |              |
|              | 协议号              | 必选         |              |              |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

进行**用户号\|用户标识，银行卡序号，业务类型，支付密码**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.  **【CIF系统】进行业务校验：**

2.  获取用户号并校验用户状态

3.  校验用户是否实名，未实名则提示“客户未实名”异常（异常码：\${客户未实名}）

4.  支付密码鉴权

5.  银行卡存在性校验

>   根据银行卡序号、客户号查询客户银行卡信息表[PER_BANK_CARD]，如果不存在，则提示“用户未绑定此银行卡”异常（异常码：\${用户未绑定此银行卡}）

1.  协议类型校验

>   根据协议类型查询业务定义表[PER_BUSINESS_DEFINE]，如果是存在实名约束，则判断银行卡是否为实名绑卡，如果不是，则提示“实名协议无法与非实名银行卡绑定”异常（异常码：\${实名协议无法与非实名银行卡绑定}）

1.  **【CIF系统】银行卡协议绑定：**

2.  生成用户级协议号、客户级协议号，记录银行卡业务订购表[PER_BIZ_CARD_BIND]

3.  如果为用户级协议，返回用户级协议号，如果为客户级协议，返回客户级协议号

4.  **【CIF系统】登记关键事件登记表**

5.  **【CIF系统】返回执行结果**

【结束流程】

##### 银行卡解绑

| **接口名称** | **银行卡解绑**     | **接口编号** | **CIF-1022** |              |
|--------------|--------------------|--------------|--------------|--------------|
| **交易代码** | **unbindBankCard** |              |              |              |
| **接口备注** |                    |              |              |              |
| **参数类型** | **名称**           | **属性**     | **业务规则** | **备注**     |
|              | 用户号             | 可选         |              | 二者必输其一 |
|              | 用户标识           | 可选         |              |              |
|              | 银行卡卡号         | 可选         |              |              |
|              | 支付密码           | 必选         |              |              |
| 输出参数     | 执行结果           | 必选         |              | 成功、失败   |
|              | 失败原因           | （必）可选   |              |              |

**【业务处理流程】**

1.  【CIF系统】进行接口必输参数校验：

>   【CIF系统】进行**用户号\|用户标识，银行卡卡号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.  **【CIF系统】进行业务校验：**

2.  **获取用户号**：

3.  如果入参上送用户号，直接获取；

4.  如果上送用户标识，通过用户标识查询**PER_个人用户登录标识**获取用户号；

-   如果用户标识不存在，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）。

-   返回用户号

1.  **验证用户是否存在（通过用户标识获取用户号不需要此验证）**

2.  通过用户号查询PER_个人用户基本信息；

3.  如果结果为空，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

4.  如果用户状态为“销户”，则提示“用户已销户”异常（异常码：\$｛用户已销户｝）；

5.  **验证锁定规则，详情见附录锁定规则**

6.  **【CIF系统】验证密码**

    上送支付密码信息，则检查用户的支付密码是否正确，根据用户号查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

7.  **验证用户是否绑定此银行卡**

    通过**用户号、业务类型、业务状态（0-有效）**查询**PER_银行卡绑定以及银行卡业务订购**，如果结果为空，则提示“此银行卡不存在”异常（异常码：\$｛此银行卡不存在｝）。

8.  **【CIF系统】进行银行卡解绑；**

    1.  **修改PER_银行卡绑定**此银行卡记录为失效；

    2.  **修改PER_银行卡绑定业务订购**此银行卡下协议失效；

9.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

10. **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

##### 银行卡协议解绑

| **接口名称** | **银行卡解绑**        | **接口编号** | **CIF-1023** |              |
|--------------|-----------------------|--------------|--------------|--------------|
| **交易代码** | **unbindBankCardAgr** |              |              |              |
| **接口备注** |                       |              |              |              |
| **参数类型** | **名称**              | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户号                | 可选         |              | 二者必输其一 |
|              | 用户标识              | 可选         |              |              |
|              | 协议类型              | 必选         |              |              |
|              | 协议号                | 必选         |              |              |
|              | 支付密码              | 必选         |              |              |
| 输出参数     | 执行结果              | 必选         |              | 成功、失败   |
|              | 失败原因              | 必选         |              |              |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

进行**用户号\|用户标识，协议类型，协议号，银行卡号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.  **【CIF系统】进行业务校验：**

2.  获取用户号并校验用户状态；

3.  支付密码鉴权；

4.  **【CIF系统】进行银行卡协议解绑：**

>   根据协议类型查询业务定义表[PER_BUSINESS_DEFINE]，确定业务种类：

1.  如果是客户级业务，根据客户号、协议号、协议状态查询银行卡业务订购表[PER_BIZ_CARD_BIND]，如果不存在记录，则提示“用户未订购此协议”异常（异常码：\$｛用户未订购此协议｝），否则以客户级协议号字段作为条件更新数据业务状态更新为失效；

2.  如果是用户级业务，根据用户、协议号、协议状态查询银行卡业务订购表[PER_BIZ_CARD_BIND]，如果不存在记录，则提示“用户未订购此协议”异常（异常码：\$｛用户未订购此协议｝），否则以用户级协议号字段作为条件更新数据业务状态更新为失效；

3.  **【CIF系统】登记关键事件登记表**

4.  **【CIF系统】返回执行结果**

【结束流程】

##### 银行卡绑定查询

| **接口名称** | **银行卡绑定查询**                             | **接口编号** | **CIF-1024**                     |                  |
|--------------|------------------------------------------------|--------------|----------------------------------|------------------|
| **交易代码** | **queryCardBiz**                               |              |                                  |                  |
| **接口备注** |                                                |              |                                  |                  |
| **参数类型** | **名称**                                       | **属性**     | **业务规则**                     | **备注**         |
| 输入参数     | 用户号                                         | 可选         |                                  | 两者至少必输其一 |
|              | 用户标识                                       | 可选         |                                  |                  |
|              | 业务类型                                       | 可选         |                                  |                  |
|              | 业务状态                                       | 可选         | 0-有效 1-无效 不上送查询全部状态 |                  |
|              | 银行卡卡号                                     | 可选         |                                  |                  |
| 输出参数     | 执行结果                                       | 必选         |                                  | 成功、失败       |
|              | 失败原因                                       | 必选         |                                  |                  |
|              | 用户号                                         | 可选         |                                  |                  |
|              | 客户姓名                                       | 可选         |                                  |                  |
|              | 银行卡信息对象列表（包括银行卡号及卡协议列表） | 可选         |                                  | List             |

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号\|用户标识**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

>   获取用户号并校验用户状态

1.  **【CIF系统】进行银行卡绑定查询：**

2.  取得用户的客户号，查询客户银行卡信息表[PER_BANK_CARD](如果上送了银行卡号，加入到查询条件)，取得银行卡信息列表，如果结果为空，则提示“用户未绑定银行卡”异常（异常码：\$｛用户未绑定银行卡｝）；

3.  循环上述银行卡信息表，如果上送业务类型，查询业务定义表[PER_BUSINESS_DEFINE]，确定业务类型：

4.  如果为客户级业务，则根据客户号、银行卡号、业务类型查询(distinct)银行卡业务订购表[PER_BIZ_CARD_BIND]，取得客户级协议号、业务类型等数据；

5.  如果为用户级业务，则根据用户号、银行卡号、业务类型查询银行卡业务订购表[PER_BIZ_CARD_BIND]，取得用户级协议号、业务类型等数据；

6.  如果未上送业务类型：

7.  先根据客户号、银行卡号、客户级业务类型查询(distinct)银行卡业务订购表[PER_BIZ_CARD_BIND]和业务定义表[PER_BUSINESS_DEFINE]，取得客户级协议号、业务类型等数据;

8.  再根据用户号、银行卡号、用户级业务类型查询银行卡业务订购表[PER_BIZ_CARD_BIND]和业务定义表[PER_BUSINESS_DEFINE]，取得用户级协议号、业务类型等数据；

9.  如果上述B或C流程均未取得数据，则提示“用户未签约协议”异常（异常码：\$｛用户未签约协议｝）；

10. **【CIF系统】返回执行结果**

【结束流程】

#### 普通业务

##### 普通业务查询

| **接口名称** | **通用业务订购查询** | **接口编号** | **CIF-1025** |              |
|--------------|----------------------|--------------|--------------|--------------|
| **交易代码** | **queryUserBiz**     |              |              |              |
| **接口备注** |                      |              |              |              |
| **参数类型** | **名称**             | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户号               | 可选         |              | 两者必输其一 |
|              | 用户标识             | 可选         |              |              |
|              | 业务分组             | 可选         |              |              |
|              | 业务类型             | 可选         |              |              |
| 输出参数     | 执行结果             | 必选         |              | 成功、失败   |
|              | 失败原因             | 必选         |              |              |
|              | 用户号               | 必选         |              |              |
|              | 普通业务对象列表     |              |              |              |
|              | 业务类型             | 必选         |              |              |
|              | 业务属性             | 必选         |              |              |
|              | 业务状态             | 必选         |              |              |
|              | 订购时间             | 必选         |              |              |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号\|用户标识、业务分组\|业务类型**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **获取用户号**：

5.  如果入参上送用户号，直接获取；

6.  如果上送用户标识，通过用户标识查询**PER_个人用户登录标识**获取用户号；

7.  如果用户标识不存在，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）。

8.  返回用户号

9.  **验证用户是否存在（通过用户标识获取用户号不需要此验证）**

10. 通过用户号查询PER_个人用户基本信息；

11. 如果结果为空，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

12. 如果用户状态为“销户”，则提示“用户已销户”异常（异常码：\$｛用户已销户｝）；

13. **【CIF系统】进行通用业务订购查询；**

14. 通过**用户号**、**业务类型\|业务分组、业务状态（0-有效）**，联合查询**PER_用户业务订购关系和PER_普通业务订购**

15. **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

##### 普通业务订购（含密码校验和验证码）

| **接口名称** | **普通业务订购（含密码校验和验证码）** | **接口编号** | **CIF-1026** |              |
|--------------|----------------------------------------|--------------|--------------|--------------|
| **交易代码** | **bindUserBiz**                        |              |              |              |
| **接口备注** |                                        |              |              |              |
| **参数类型** | **名称**                               | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户号                                 | 可选         |              | 两者必输其一 |
|              | 用户标识                               | 可选         |              |              |
|              | 业务类型                               | 必选         |              |              |
|              | 支付密码                               | 必选         |              |              |
|              | 手机短信验证码回执编号                 | 可选         |              | 同时选输     |
|              | 手机验证码                             | 可选         |              |              |
| 输出参数     | 执行结果                               | 必选         |              | 成功、失败   |
|              | 失败原因                               | （必）可选   |              |              |
|              | 用户号                                 | 必选         |              |              |
|              | 业务订购关系编号                       | 必选         |              |              |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号\|用户标识，业务类型**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **获取用户号**：

5.  如果入参上送用户号，直接获取；

6.  如果上送用户标识，通过用户标识查询**PER_个人用户登录标识**获取用户号；

7.  如果用户标识不存在，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）。

8.  返回用户号

9.  **验证用户是否存在（通过用户标识获取用户号不需要此验证）**

10. 通过用户号查询PER_个人用户基本信息；

11. 如果结果为空，则提示“用户不存在”异常（异常码：\$｛用户不存在｝）；

12. 如果用户状态为“销户”，则提示“用户已销户”异常（异常码：\$｛用户已销户｝）；

13. **验证锁定规则，详情见附录锁定规则**

14. **验证用户是否已经订购此业务**

15. 通过**用户号**、**业务类型、业务状态（0-有效）**查询**PER_用户业务订购关系**，如果结果不为空，且此业务唯一性约束为Y（通过业务类型查询PER_CIF业务定义表获取唯一性约束），则返回信息。

16. **【CIF系统】进行普通业务订购；**

17. 创建**PER_用户业务订购关系**（业务状态：0-有效，记录创建日期SYSTIMESTAMP）；

18. **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

19. **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

### 协议终止

#### 业务订购协议终止（含支付密码和验证码）

| **接口名称** | **业务订购协议终止**（含支付密码和验证码）                                | **接口编号** | **CIF-1027**                 |                  |
|--------------|---------------------------------------------------------------------------|--------------|------------------------------|------------------|
| **交易代码** | **unbindUserBiz**                                                         |              |                              |                  |
| **接口备注** | 1. 按指定协议回执编号终止所订购的协议，并解除相应产品及业务功能的绑定关系 |              |                              |                  |
| **参数类型** | **名称**                                                                  | **属性**     | **业务规则**                 | **备注**         |
|              | 用户号                                                                    | 可选         |                              |                  |
|              | 业务订购关系编号                                                          | 可选         | 业务类型不能确定唯一时需上送 | 两者至少必输其一 |
|              | 业务类型                                                                  | 必选         |                              |                  |
|              | 支付密码                                                                  | 必选         |                              |                  |
|              | 手机短信验证码回执编号                                                    | 可选         |                              |                  |
|              | 手机验证码                                                                | 可选         |                              |                  |
| 输出参数     | 执行结果                                                                  | 必选         |                              | 成功、失败       |
|              | 失败原因                                                                  | （必）可选   |                              |                  |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**用户号、业务类型\|业务订购关系编号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **验证锁定规则，详情见附录锁定规则**

5.  **【CIF系统】进行业务订购查询；**

6.  则通过**用户号、业务类型（业务订购关系编号）、业务状态（0-有效）**查询**PER_用户业务订购关系**，如果查询结果为空则提示“用户未订购该业务”异常（异常码：\$｛用户未订购该业务｝）；如果未上送业务订购关系编号，查询结果不唯一，则提示“查询结果不唯一，需上送业务订购关系编号”异常（异常码：\$｛查询结果不唯一，需上送业务订购关系编号｝）；

7.  **【CIF系统】验证密码**

8.  上送支付密码信息，则检查用户的支付密码是否正确，根据用户号查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

9.  **【CIF系统】验证码验证**

>   如果业务系统上送了短信验证码编号与短信验证码，则进行短信验证码校验：

>   校验短信验证码的有效性：通过查询短信验证码信息表
>   以手机号、短信验证码编号为查询条件，与CIF系统短信验证码存留信息进行比对：

>   a)
>   如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

>   b) 如果查到相应记录，则检查此验证码是有效（系统当前时间 -
>   短信验证码发送时间\<=短信验证码失效时间（此参数维护在系统参数表中））；

>   i. 如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

>   ii.
>   如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

1.  **【CIF系统】解除业务订购**

>   根据查询结果，更新**PER_客户业务订购关系**或**PER_用户业务订购关系**的**退订时间**及**业务状态（1-失效）**

1.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

2.  **【CIF系统】发送推送通知**（目前只有信用支付需要）

3.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

鉴权
----

### 登录密码鉴权

| **接口名称** | 登录密码鉴权         | **接口编号** | **CIF-1028** |            |
|--------------|----------------------|--------------|--------------|------------|
| **交易代码** | authLoginPwd         |              |              |            |
| **接口备注** |                      |              |              |            |
| **参数类型** | **名称**             | **属性**     | **业务规则** | **备注**   |
|              | 登录标识             | 必选         |              |            |
|              | 登录密码             | 必选         |              |            |
|              | 短信验证码           | 可选         |              | 同时选输   |
|              | 短信回执序列号       | 可选         |              |            |
| 输出参数     | 执行结果             | 必选         |              | 成功、失败 |
|              | 失败原因             | （必）可选   |              |            |
|              | 用本信息对象         | 可选         |              |            |
|              | 客户信息对象         | 可选         |              |            |
|              | 连续错误次数         | 可选         |              |            |
|              | 累计错误次数         | 可选         |              |            |
|              | 剩余可用连续错误次数 | 可选         |              |            |
|              | 剩余可用累计错误次数 | 可选         |              |            |

**【业务处理流程】**

1.  通过 *用户号 + 密码 + 短信验证码（可选）* 登录。

2.  通过 *登录标识 + 密码 + 短信验证码（可选）* 登录。

3.  **【CIF系统】进行接口必输参数校验：**

>   1.1
>   【CIF系统】进行按上面组合校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.2
【CIF系统】检查业务系统是否上送了**用户标识**，如果业务系统上送不完整，则提示“用户标识参数不完整”异常（异常码：\${用户标识参数不完整}）。

1.  **【CIF系统】业务逻辑检查：**

>   2.1 检查用户状态（锁定，销户，未激活等），未通过记录失败异常事件，返回。

>   2.2 检查客户状态，未通过记录失败异常事件，返回。

>   2.3 检查密码锁定状态，未通过记录失败异常事件，返回。

>   2.4
>   检查密码，校验码是否匹配，失败则记录异常事件表，返回；连续错误到达上限或累计错误到达上限锁定密码。

1.  **【CIF系统】返回：**

    1.  返回用户 + 客户信息（如果用户有关联客户）

### 支付密码鉴权

| **接口名称** | 支付密码鉴权         | **接口编号** | **CIF-1029** |              |
|--------------|----------------------|--------------|--------------|--------------|
| **交易代码** | authPayPwd           |              |              |              |
| **接口备注** |                      |              |              |              |
| **参数类型** | **名称**             | **属性**     | **业务规则** | **备注**     |
| 输入参数     | 用户号               | 可选         |              | 二者必输其一 |
|              | 登录标识             | 可选         |              |              |
|              | 支付密码             | 必选         |              |              |
|              | 短信验证码           | 可选         |              | 同时选输     |
|              | 短信回执序列号       | 可选         |              |              |
| 输出参数     | 执行结果             | 必选         |              | 成功、失败   |
|              | 失败原因             | （必）可选   |              |              |
|              | 用本信息对象         | 可选         |              |              |
|              | 客户信息对象         | 可选         |              |              |
|              | 连续错误次数         | 可选         |              |              |
|              | 累计错误次数         | 可选         |              |              |
|              | 剩余可用连续错误次数 | 可选         |              |              |
|              | 剩余可用累计错误次数 | 可选         |              |              |

**【业务处理流程】**

1.  通过 *用户号 + 支付密码 + 短信验证码（可选）* 校验。

2.  通过 *登录标识 + 支付密码+ 短信验证码（可选）*校验。

3.  **【CIF系统】进行接口必输参数校验：**

>   1.1
>   【CIF系统】进行按上面组合校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.2
【CIF系统】检查业务系统是否上送了**用户标识**，如果业务系统上送不完整，则提示“用户标识参数不完整”异常（异常码：\${用户标识参数不完整}）。

1.  **【CIF系统】业务逻辑检查：**

>   2.1根据交易类型，进行相应的检查：

>   检查用户状态（锁定，销户，未激活等），未通过记录失败异常事件，返回。

>   检查客户状态（检查资金支付状态，黑名单状态等），未通过记录失败异常事件，返回。

>   2.2 检查密码锁定状态，未通过记录失败异常事件，返回。

>   2.3
>   检查支付密码，校验码是否匹配，失败则记录异常事件表，返回；连续错误到达上限或累计错误到达上限锁定密码。

1.  **【CIF系统】返回：**

    1.  完全通过返回成功

### 发送短信验证码

| **接口名称** | 发送短信验证码     | **接口编号** | **CIF-1030** |            |
|--------------|--------------------|--------------|--------------|------------|
| **交易代码** | **sendSmsVerCode** |              |              |            |
| **接口备注** |                    |              |              |            |
| **参数类型** | **名称**           | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 目标手机号码       | 必选         |              |            |
|              | 短信模板编号       | 必选         |              |            |
|              | 模板参数           | 可选         |              |            |
| 输出参数     | 执行结果           | 必选         |              | 成功、失败 |
|              | 失败原因           | （必）可选   |              |            |
|              | 验证码回执编号     | 必选         |              |            |

**【业务处理流程】**

>   **1. 【CIF系统】进行接口必输参数校验：**

>   【CIF系统】进行**目标手机号码**和**短信模板编号**必输校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.  **【CIF系统】 发送短信验证码**

A.
从sequence取到验证码回执编号，根据目标手机号码和短信模板编号查询短信验证码信息表，若没有数据，则新增一条数据，若有数据则做更新操作；

B. 根据短信模板编号得到短信模板，调用空服发送短信；

**3. 【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

### 短信验证码验证

| **接口名称** | 短信验证码验证     | **接口编号** | **CIF-1031** |            |
|--------------|--------------------|--------------|--------------|------------|
| **交易代码** | **authSmsVerCode** |              |              |            |
| **接口备注** |                    |              |              |            |
| **参数类型** | **名称**           | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 手机号码           | 必选         |              |            |
|              | 短信验证码         | 必选         |              |            |
|              | 验证码回执编号     | 必选         |              |            |
| 输出参数     | 执行结果           | 必选         |              | 成功、失败 |
|              | 失败原因           | （必）可选   |              |            |

**【业务处理流程】**

>   **1. 【CIF系统】进行接口必输参数校验：**

>   【CIF系统】进行**手机号码、短信验证码、验证码回执编号**必输校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

**2. 【CIF系统】 校验短信验证码**

A.
根据手机号码查询短信验证信息表，按照降序排序，若没有查询到数据，则提示“短信验证码不存在”异常（异常码：\$｛短信验证码不存在｝）；若查询到数据取出第一条，判断状态是否是有效的，若无效，则提示“短信验证码无效”异常（异常码：\$｛短信验证码无效｝）；若验证码验证时间已过，则提示“短信验证码已过期”异常（异常码：\$｛短信验证码已过期｝）；比对短信验证码，若不一致，则提示“短信验证码错误”异常（异常码：\$｛短信验证码错误｝）；

B. 验证通过后，更新一下验证信息表的状态为已失效。

**3. 【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

### 短信验证码预鉴权

| **接口名称** | 短信验证码预鉴权      | **接口编号** |              |            |
|--------------|-----------------------|--------------|--------------|------------|
| **交易代码** | **perAuthSmsVerCode** |              |              |            |
| **接口备注** |                       |              |              |            |
| **参数类型** | **名称**              | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 手机号码              | 必选         |              |            |
|              | 短信验证码            | 必选         |              |            |
|              | 验证码回执编号        | 必选         |              |            |
| 输出参数     | 执行结果              | 必选         |              | 成功、失败 |
|              | 失败原因              | （必）可选   |              |            |

**【业务处理流程】**

>   **1. 【CIF系统】进行接口必输参数校验：**

>   【CIF系统】进行**手机号码、短信验证码、验证码回执编号**必输校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

**2. 【CIF系统】 校验短信验证码**

A.
根据手机号码查询短信验证信息表，按照降序排序，若没有查询到数据，则提示“短信验证码不存在”异常（异常码：\$｛短信验证码不存在｝）；若查询到数据取出第一条，判断状态和预鉴权状态是否是有效的，若无效，则提示“短信验证码无效”异常（异常码：\$｛短信验证码无效｝）；若验证码验证时间已过，则提示“短信验证码已过期”异常（异常码：\$｛短信验证码已过期｝）；比对短信验证码，若不一致，则提示“短信验证码错误”异常（异常码：\$｛短信验证码错误｝）；

B. 验证通过后，更新一下验证信息表的预鉴权状态为已失效。

**3. 【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

### 发送邮箱验证码

| **接口名称** | 发送邮箱验证码      | **接口编号** | **CIF-1032** |            |
|--------------|---------------------|--------------|--------------|------------|
| **交易代码** | **sendMailVerCode** |              |              |            |
| **接口备注** |                     |              |              |            |
| **参数类型** | **名称**            | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 目标邮箱            | 必选         |              |            |
|              | 邮箱模板编号        | 必选         |              |            |
|              | 模板参数            | 可选         |              |            |
| 输出参数     | 执行结果            | 必选         |              | 成功、失败 |
|              | 失败原因            | （必）可选   |              |            |
|              | 验证码回执编号      | 必选         |              |            |

**【业务处理流程】**

>   **1. 【CIF系统】进行接口必输参数校验：**

>   【CIF系统】进行**目标邮箱**和**邮箱模板编号**必输校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

1.  **【CIF系统】 发送邮箱验证码**

A.
从sequence取到验证码回执编号，根据目标邮箱和邮箱模板编号查询邮箱验证码信息表，若没有数据，则新增一条数据，若有数据则做更新操作；

B. 根据邮箱模板编号得到短信模板，调用空服发送邮件；

**3. 【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

### 邮箱验证码验证

| **接口名称** | 短信验证码验证      | **接口编号** | **CIF-1033** |            |
|--------------|---------------------|--------------|--------------|------------|
| **交易代码** | **authMailVerCode** |              |              |            |
| **接口备注** |                     |              |              |            |
| **参数类型** | **名称**            | **属性**     | **业务规则** | **备注**   |
| 输入参数     | 邮箱                | 必选         |              |            |
|              | 邮箱验证码          | 必选         |              |            |
|              | 验证码回执编号      | 必选         |              |            |
| 输出参数     | 执行结果            | 必选         |              | 成功、失败 |
|              | 失败原因            | （必）可选   |              |            |

**【业务处理流程】**

>   **1. 【CIF系统】进行接口必输参数校验：**

>   【CIF系统】进行**邮箱、邮箱验证码、验证码回执编号**必输校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

**2. 【CIF系统】 校验邮箱验证码**

A.
根据邮箱查询邮箱验证信息表，按照降序排序，若没有查询到数据，则提示“邮箱验证码不存在”异常（异常码：\$｛邮箱验证码不存在｝）；若查询到数据取出第一条，判断状态是否是有效的，若无效，则提示“邮箱验证码无效”异常（异常码：\$｛邮箱验证码无效｝）；若验证码验证时间已过，则提示“邮箱验证码已过期”异常（异常码：\$｛邮箱验证码已过期｝）；比对邮箱验证码，若不一致，则提示“邮箱验证码错误”异常（异常码：\$｛邮箱验证码错误｝）；

B. 验证通过后，更新一下验证信息表的状态为已失效。

**3. 【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

【结束流程】

客户归并
--------

### 用户鉴权客户归并

用户到客户归并，是当某个用户被识别成客户之后进行关联的过程，发起归并用户和被归并客户二者必须是既存的。支持无客户用户和有未实名客户。客户的归并应当是用户提交了某一项可用来标识客户的证件（证件国别，证件类型，证件号码）（此接口必须在客户标识验证后使用，这个标识应该是已经在业务系统中去判断，后台直接做归并操作），识别成功后获得既存客户下所有用户列表（使用接口CIF-2093），通过选择一个用户并使用本接口进行鉴权支付密码来确认用户身份，之后进行客户归并。本接口不适用于两个已实名客户的归并，相关功能由手动客户合并实现。

| **接口名称** | **用户鉴权客户归并**                                                                                                                | **接口编号** | **CIF-1034** |                                  |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------|--------------|--------------|----------------------------------|
| **接口编号** | **mergeUserToCust**                                                                                                                 |              |              |                                  |
| **接口备注** | 1、发起归并用户必须无实名客户 2、被归并用户与发起归并用户为不同用户 3、发起归并用户有未实名客户，发起方除用户信息外其它信息会被清除 |              |              |                                  |
| **参数类型** | 名称                                                                                                                                |              | 属性         | **业务规则**                     |
| 输入参数     | 证件类型                                                                                                                            |              | 必填         | 码表0205                         |
|              | 证件号码                                                                                                                            |              | 必填         |                                  |
|              | 证件国别                                                                                                                            |              | 必填         | 码表0209                         |
|              | 客户名称                                                                                                                            |              | 必填         |                                  |
|              | 被归并用户号                                                                                                                        |              | 必填         | 通过用户号获取被归并客户号       |
|              | 发起归并用户号                                                                                                                      |              | 必填         |                                  |
|              | 支付密码                                                                                                                            |              | 必填         | 被归并用户所属                   |
|              | 短信验证码                                                                                                                          |              | 必填         | 非空则验证短信验证码             |
|              | 短信序列号                                                                                                                          |              | 必填         | 在短信验证码非空的情况下必须非空 |
| 输出参数     | 返回标志                                                                                                                            |              | 选输         | 返回代码：COM00000-成功          |
|              | 返回备注                                                                                                                            |              | 选输         | 失败，必需返回失败原因           |

**【业务处理流程】**

1.  **【CIF系统】进行接口必输参数校验：**

2.  【CIF系统】进行**证件类型，证件号码，证件国别，证件姓名，被归并用户号，支付密码，发起归并用户号，短信验证码，短信序列号**校验，如果不通过，则提示“接口输入参数缺失”异常（异常码：\$｛接口输入参数缺失｝）；

3.  **【CIF系统】进行业务校验：**

4.  **校验证件信息正确性**

>   通过**证件类型，证件号码，证件国别**查询Per_个人客户标识信息，确认证件信息是否存在，若不存在则提示“证件信息错误”异常（异常码：\${证件信息错误}）；校验**证件姓名**与个人客户标识信息中的客户姓名是否一致，不一致则提示“证件信息错误”异常（异常码：\${证件信息错误}）；（提示信息一致，以免误将证件是否存在提示给恶意撞库者）

1.  **校验被归并用户号所属用户及实名客户是否存在：**

>   通过用户号查询PER_个人用户基本信息表，查看用户是否存在且为未销户，如果用户不存在，则提示“用户不存在”异常（异常码：\${被归并用户不存在}）；查询个人客户基本信息表，查看被归并用户所属客户是否存在且为未销户，如果客户不存在，则提示“归并客户不存在”异常（异常码：\${归并客户不存在}）

1.  **校验证件所属客户与被归并用户所属客户是否相同**

>   校验A步骤个人客户标识信息中的客户ID与B步骤中个人用户基本信息中的客户ID是否一致，不一致则提示“证件信息与客户不匹配”异常（异常码：\${证件信息与客户不匹配}）；

1.  **校验发起归并用户所属客户是否为未实名客户：**

>   首先通过用户号查询PER_个人用户基本信息表，判断客户号是否存在，存在则通过客户号查询PER_个人客户基本信息，并判断ATH_STA是否为未实名，若不是则提示“发起归并用户已实名，不可归并”异常（异常码：\${发起归并用户已实名，不可归并}）；

1.  **校验被归并客户下用户数是否已经达到系统参数设定值：**

>   判断被归并客户下状态正常的用户数量是否已经达到了系统参数配置表PER_PARA_MAIN中的CUST_MAX_USER_QUANTITY客户最大用户数量，若已达到则则提示“客户下用户数已达到最大数量”异常（异常码：\${客户下用户数已达到最大数量}）

1.  **短信验证码校验**：

>   校验短信验证码的有效性：通过查询*短信验证码信息表*
>   以**手机号、验证码序列号**为查询条件，与CIF系统短信验证码存留信息进行比对：

1.  如果没有相应记录，则提示“短信验证码非法”异常（异常码：\${短信验证码非法}）；

2.  如果查到相应记录，则检查此验证码是有效（系统当前时间 -
    短信验证码发送时间\<=短信验证码失效时间（此参数维护在*系统参数表*中）），

3.  如果无效，则提示“短信验证码已失效”异常（异常码：\${短信验证码失效}）；

4.  如果有效，则比对业务系统上送的验证码是否与CIF存留值相同，如果不相同，则提示“短信验证码错误”异常（异常码：\${短信验证码错误}）。

5.  **【CIF系统】检查支付密码是否正确：**

>   检查用户的**支付密码**是否正确，根据被归并用户号和支付密码类型查询用户支付密码，和上送的支付密码比较，如果不一致，则报“支付密码错误”异常（异常码：\${支付密码错误}）

1.  **【CIF系统】进行客户归并**

2.  根据用户号和被归并用户所属客户号（2、**【CIF系统】进行业务校验**C步中获取到），更新**PER_个人用户基本信息表**的客户号，并将**PER_个人用户基本信息表**的标识Identify字段更新为Y。

3.  **【CIF系统】进行维护日志登记（系统维护日志表、系统维护日志明细表）。**

4.  **【CIF系统返回执行结果】**

>   如果失败，则返回失败原因。

>   【结束流程】

附录
====

锁定规则
--------

| 状态         | 规则                                                                           | 说明 |
|--------------|--------------------------------------------------------------------------------|------|
| 客户锁定     | 客户及客户下关联用户，不允许进行新增、更新和删除操作                           |      |
| 用户锁定     | 用户相关交易不允许进行新增、更新和删除操作                                     |      |
| 登录密码锁定 | 不允许进行登录密码修改、重置等操作                                             |      |
| 支付密码锁定 | 不允许进行支付密码修改、重置等操作以及通过支付密码作为验证条件的修改、重置交易 |      |
|              |                                                                                |      |
|              |                                                                                |      |
